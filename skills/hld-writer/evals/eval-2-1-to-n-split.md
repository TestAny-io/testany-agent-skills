# Eval 2: 1:N 拆分场景

## 场景描述

一个大型 PRD，需要拆分为多个 HLD。测试 skill 的拆分识别、索引文档创建、跨 HLD 依赖管理能力。

## 测试输入

- **PRD 文件**：`test-inputs/prd-ecommerce-large.md`
- **用户指令**：`帮我写这个 PRD 的 HLD`

## 预期行为

### 拆分识别

| 步骤 | 预期行为 | 必须/可选 |
|------|---------|----------|
| 识别拆分信号 | 识别到硬信号（数据边界、发布独立等） | 必须 |
| 确认拆分 | 使用 AskUserQuestion 确认拆分方式 | 必须 |
| 不自作主张 | 仅软信号时不自动拆分 | 必须 |

### 索引文档创建

| 步骤 | 预期行为 | 必须/可选 |
|------|---------|----------|
| 创建索引 | 创建 `HLD-INDEX-xxx.md` | 必须 |
| HLD 清单 | 列出所有 HLD 文档 | 必须 |
| 覆盖总表 | 包含 PRD 需求覆盖总表 | 必须 |
| 覆盖率 100% | 所有 PRD 需求都已分配 | 必须 |

### 跨 HLD 管理

| 步骤 | 预期行为 | 必须/可选 |
|------|---------|----------|
| 依赖声明 | 索引文档包含跨 HLD 依赖表 | 必须 |
| 接口契约 | 跨 HLD 接口有明确定义位置 | 必须 |
| 单 HLD 标注 | 每个 HLD 标注覆盖范围和索引引用 | 必须 |

## 评分标准

| 维度 | 权重 | 通过条件 | 得分 |
|------|------|---------|------|
| **拆分识别正确** | 15% | 识别到正确的拆分信号 | /15 |
| **用户确认拆分** | 10% | 使用 AskUserQuestion 确认 | /10 |
| **索引文档存在** | 15% | 创建 HLD-INDEX-xxx.md | /15 |
| **覆盖率 100%** | 20% | 所有 PRD 需求都已分配到 HLD | /20 |
| **跨 HLD 依赖声明** | 15% | 索引包含依赖关系表 | /15 |
| **单 HLD 标注完整** | 15% | 每个 HLD 有覆盖范围和索引引用 | /15 |
| **接口契约明确** | 10% | 跨 HLD 接口定义位置清晰 | /10 |
| **总分** | 100% | | /100 |

## 常见失败模式

| 失败模式 | 扣分 | 如何检测 |
|---------|------|---------|
| 未识别拆分需求 | -15 | 大 PRD 产出单个臃肿 HLD |
| 自动拆分不确认 | -10 | 未使用 AskUserQuestion 确认拆分 |
| 无索引文档 | -15 | 多 HLD 但无 HLD-INDEX |
| 覆盖率 < 100% | -20 | PRD 需求未全部分配 |
| 跨 HLD 依赖缺失 | -15 | 依赖关系未声明 |
| 接口契约位置不明 | -10 | 不知道在哪个 HLD 找接口定义 |

## 拆分信号检测点

测试用 PRD 应包含以下拆分硬信号：

1. **数据边界**：用户数据 vs 订单数据 vs 支付数据
2. **发布独立**：用户系统稳定，订单系统频繁迭代
3. **合规域**：支付模块有 PCI-DSS 要求

正确识别应建议拆分为：
- HLD-用户系统
- HLD-订单系统
- HLD-支付系统

## 测试记录模板

```markdown
## 测试记录

- **测试日期**：YYYY-MM-DD
- **测试模型**：Haiku / Sonnet / Opus
- **skill 版本**：vX.X

### 拆分结果

- **识别的拆分信号**：[列出]
- **最终拆分方案**：[HLD 列表]
- **用户确认方式**：AskUserQuestion / 未确认

### 评分

| 维度 | 得分 | 备注 |
|------|------|------|
| 拆分识别正确 | /15 | |
| 用户确认拆分 | /10 | |
| 索引文档存在 | /15 | |
| 覆盖率 100% | /20 | |
| 跨 HLD 依赖声明 | /15 | |
| 单 HLD 标注完整 | /15 | |
| 接口契约明确 | /10 | |
| **总分** | /100 | |

### 发现的问题

1. [问题描述]

### 改进建议

1. [建议]
```
