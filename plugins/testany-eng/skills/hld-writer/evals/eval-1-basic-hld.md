# Eval 1: 基础 HLD 场景

## 场景描述

单个中等复杂度的 PRD，产出单个 HLD。这是最常见的使用场景。

## 测试输入

- **PRD 文件**：`test-inputs/prd-user-auth.md`
- **用户指令**：`帮我写这个 PRD 的 HLD`

## 预期行为

### 阶段零：上下文收集

| 步骤 | 预期行为 | 必须/可选 |
|------|---------|----------|
| 0.1 | 使用 Glob 扫描项目文档 | 必须 |
| 0.2 | 使用 AskUserQuestion 确认文档 | 必须 |
| 0.3 | 读取用户确认的文档 | 必须 |
| 0.4 | 识别可复用资源 | 必须 |
| 0.5 | 记录关键约束 | 必须 |
| 0.6 | 输出上下文收集报告 | 必须 |

### 阶段一：需求理解

| 步骤 | 预期行为 | 必须/可选 |
|------|---------|----------|
| 识别类型 | 正确识别为「新功能（有 UI）」或「新功能（纯后端）」 | 必须 |
| 确认约束 | 使用 AskUserQuestion 确认技术选型偏好 | 可选（PRD 已明确时可跳过） |

### 阶段二：结构规划

| 步骤 | 预期行为 | 必须/可选 |
|------|---------|----------|
| 读取模板 | 读取 `assets/new-feature-*.md` | 必须 |
| 规划大纲 | 输出文档大纲 | 可选 |

### 阶段三：内容撰写

| 步骤 | 预期行为 | 必须/可选 |
|------|---------|----------|
| 需求映射表 | 包含 PRD↔HLD 需求映射表 | 必须 |
| 架构图 | 包含 Mermaid 架构图 | 必须 |
| 技术选型 | 每个选型有理由 | 必须 |
| API 契约 | 跨服务接口有定义 | 必须 |

### 阶段四：强制审查

| 步骤 | 预期行为 | 必须/可选 |
|------|---------|----------|
| 执行审查 | 执行 4.1-4.5 所有检查项 | 必须 |
| 修复问题 | 发现问题后修复 | 必须 |

## 评分标准

| 维度 | 权重 | 通过条件 | 得分 |
|------|------|---------|------|
| **阶段零执行** | 20% | 输出上下文收集报告 | /20 |
| **需求映射完整** | 25% | 每个 PRD 需求都有对应 HLD 章节 | /25 |
| **边界正确** | 20% | 不包含 LLD 内容（函数签名、具体参数） | /20 |
| **技术选型有理由** | 15% | 每个技术选型都附带理由 | /15 |
| **架构图存在** | 10% | 包含 Mermaid 格式架构图 | /10 |
| **强制审查执行** | 10% | 有审查痕迹（checklist 或说明） | /10 |
| **总分** | 100% | | /100 |

## 常见失败模式

| 失败模式 | 扣分 | 如何检测 |
|---------|------|---------|
| 跳过阶段零 | -20 | 无上下文收集报告 |
| 需求映射不完整 | -5~-25 | PRD 条目未全部出现在映射表 |
| 越界到 LLD | -10~-20 | 包含具体 TTL、超时参数、函数签名 |
| 技术选型无理由 | -5~-15 | 选型只有结论没有理由 |
| 猜测技术现状 | -10 | 描述现有架构但无文档/代码来源 |

## 测试记录模板

```markdown
## 测试记录

- **测试日期**：YYYY-MM-DD
- **测试模型**：Haiku / Sonnet / Opus
- **skill 版本**：vX.X

### 评分

| 维度 | 得分 | 备注 |
|------|------|------|
| 阶段零执行 | /20 | |
| 需求映射完整 | /25 | |
| 边界正确 | /20 | |
| 技术选型有理由 | /15 | |
| 架构图存在 | /10 | |
| 强制审查执行 | /10 | |
| **总分** | /100 | |

### 发现的问题

1. [问题描述]
2. [问题描述]

### 改进建议

1. [建议]
```
