# Changelog

本文件记录 Testany Agent Skills 的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [Semantic Versioning](https://semver.org/lang/zh-CN/)。

## [1.6.0] - 2026-01-07

### 新增

- **prd-reviewer** 技能：PRD 审查专家（"需求评审会议的 AI 化"）
  - 作为 PRD 的"准出门禁"，严格把关，迭代审查直到放行
  - 8 大审查维度：结构完整性、业务逻辑（PM视角）、需求清晰度（开发视角）、可测试性（QA视角）、业务方视角、内容边界、证据可追溯性、一致性
  - 问题分级：P0 阻塞、P1 严重、P2 建议
  - 输出审查报告和准出证书
  - 支持迭代审查直到通过

---

## [1.5.2] - 2026-01-07

### 变更

- **prd-writer 行为约束**（解决"参考文档读取不足"和"猜测"问题）
  - 新增核心原则「基于证据，不猜测」— 禁止凭空推测项目现状
  - **阶段零重构为"先扫描后确认"模式**：
    - 0.1 先扫描项目文档（只收集路径，不读取内容）
    - 0.2 通过 AskUserQuestion 让用户确认哪些文档需要读取，避免上下文爆炸和读入过时文档
    - 0.3 只读取用户确认的文档
  - **扫描优化**：排除 `node_modules/`, `.git/`, `dist/` 等目录；Agent 自动初筛，只展示高置信度结果给用户
  - 阶段零新增「上下文收集报告」强制输出
  - 「相关能力识别」表格新增「来源」列，强制注明从哪个文档/代码中识别
  - 「禁止行为」章节扩展，明确禁止猜测相关行为
  - 审查清单新增「证据检查」环节

- **hld-writer 行为约束**（同步 prd-writer 改进）
  - 新增核心原则「基于证据，不猜测」
  - **阶段零重构为"先扫描后确认"模式**（同 prd-writer）
  - **扫描优化**：排除噪音目录，Agent 自动初筛高置信度结果
  - 「禁止行为」章节扩展
  - 审查清单新增「证据检查」环节

### 修复

- **prd-writer/hld-writer 证据检查规则矛盾**
  - 修正「上下文收集报告是否已输出并获得用户确认」为「是否已输出」，消除与「报告无需确认」的冲突

- **hld-writer 复用盘点表格缺少来源列**
  - 所有 5 个 HLD 模板的「复用盘点」表格新增「来源」列，与 SKILL 中「必须注明来源」要求一致

- **prd-writer integration.md 缺少兼容性与发布要求**
  - 新增 7.4 兼容性要求、7.5 发布要求章节，与其他 PRD 模板保持一致

- **hld-writer API 重复维护风险**
  - new-feature-backend.md、new-feature-ui.md 的 API 设计章节新增「引用已有规范」指引
  - 接口列表表格新增「规范位置」列，支持引用已有 OpenAPI 规范路径

---

## [1.5.1] - 2026-01-07

### 变更

- **prd-writer 模板完善**（提升输出一致性和可追溯性）
  - 「相关能力识别」改为强制表格结构（已有能力、能力范围、与本需求匹配度、能力差距、建议方向）
  - 元信息新增「PRD 基线版本」和「最后同步日期」字段，便于 PRD→HLD 变更追溯
  - 所有 5 个模板同步新增「相关能力识别」「发布要求」章节
  - refactoring.md 和 optimization.md 补齐缺失章节

- **hld-writer 模板完善**
  - integration.md、refactoring.md、optimization.md 新增「埋点/监控设计（承接 PRD 成功指标）」章节

---

## [1.5.0] - 2026-01-07

### 变更

- **prd-writer 改进**（解决已有系统新增功能场景的漂移风险）
  - 新增「业务现状与变更」章节（现有流程、变更内容、影响范围）
  - 新增「相关能力识别」章节（识别已有能力，复用决策留给 HLD）
  - 新增「兼容性要求」和「发布要求」到非功能需求
  - 成功指标表格增加「数据来源」列（已有埋点/需新增/人工统计）
  - 阶段零增加「识别业务现状与相关能力」步骤
  - 审查清单增加业务现状与成功指标检查项

- **hld-writer 对应改进**（承接 PRD 新增要求）
  - 新增「技术现状与变更」章节（受影响组件、架构变更）
  - 新增「兼容性设计」章节（接口/数据兼容方案）
  - 新增「发布策略」章节（灰度/回滚/功能开关）
  - 新增「埋点/监控设计」章节（承接 PRD 成功指标）
  - HLD 应包含内容表格新增对应条目

---

## [1.4.2] - 2026-01-07

### 变更

- **hld-writer 模板改进**
  - 所有 5 个模板新增「复用盘点」章节，强制记录候选方案与评估结论
  - 数据设计章节改为「概念级」，移除字段类型/长度等 LLD 细节
  - 集成模板的数据映射章节标注为「跨系统契约」，区分于内部数据设计

---

## [1.4.1] - 2026-01-07

### 变更

- **hld-writer 改进**
  - 新增核心原则：技术栈对齐、复用优先、需求可追溯
  - 新增 PRD↔HLD 需求映射表为强制输出
  - 错误码/错误契约明确为 HLD 内容（跨团队契约）
  - 数据设计明确为策略级（非字段级）
  - API 契约明确为跨团队场景，优先引用已有 OpenAPI
  - 阶段零增加「识别可复用资源」和「查找技术规范」步骤
  - 审查清单增加映射表、复用、技术栈对齐检查项

### 修复

- 修复 5 个 HLD 模板的嵌套代码块问题（影响 Mermaid 图表渲染）
- 所有模板新增 PRD↔HLD 需求映射表章节

---

## [1.4.0] - 2026-01-07

### 新增

- **hld-writer** 技能：高层技术设计文档（HLD）写作助手
  - 承接 PRD，解决 How（架构级）决策
  - 聚焦高成本/跨团队/高风险决策，工程师仍可做局部选择
  - 明确 HLD vs LLD 边界：HLD 给策略，LLD 给参数和实现
  - 支持 5 种 HLD 类型：新功能（有UI/纯后端）、第三方集成、重构、优化
  - 包含 5 个专业模板

---

## [1.3.0] - 2026-01-06

### 新增

- **prompt-optimizer** 技能：AI 提示词优化专家
  - 支持 6 大平台语法级适配：Claude（XML）、ChatGPT（Markdown）、DeepSeek（CoT）、豆包、智谱 GLM、Gemini
  - 迭代式优化流程：多轮执行 4D 方法论，自我评判达标后才交付
  - 7 项自我评判清单：意图清晰、无歧义、信息完整、结构合理、平台适配、精简度、可执行
  - 负面约束机制：禁止过度修饰、无端膨胀、道德说教、虚构信息等
  - DeepSeek R1 特别适配：避免格式约束干扰思维链

### 变更

- **skill-creator 本地化**
  - SKILL.md 重写为中文，加入 Testany 命名/结构约定和审核标准
  - `init_skill.py` 默认输出路径改为 `skills/`
  - 模板内容全部中文化
- **marketplace.json 结构调整**
  - 每个 skill 拆分为独立 plugin，方便用户浏览时看到描述

---

## [1.2.0] - 2026-01-06

### 新增

- **skill-creator** 技能：Skill 创建指南，帮助创建和优化 Claude Code Skills
  - 包含 `init_skill.py`、`package_skill.py`、`quick_validate.py` 脚本
  - 提供完整的 skill 编写最佳实践
- **spec/** 目录：Agent Skills 规范文档
  - `agent-skills-spec.md`：规范总览
  - `skill-authoring.md`：Skill 编写指南
  - `skill-client-integration.md`：客户端集成指南

### 变更

- **prd-writer 改进**
  - Frontmatter description 加入触发词，提升激活可靠性
  - `templates/` 目录改名为 `references/`，符合 skill 最佳实践
  - 「选型分析/选定方案」改为「方案分析/建议方案」，最终选型决定留给 HLD
  - 语言规范增加「用户要求英文时可切换」例外条款
- **README.md** 重写，符合仓库级别定位

### 修复

- 修复 `integration.md` 表格缺失 pipe 的格式问题
- 修复 `new-feature-backend.md` 嵌套代码围栏导致的格式解析问题

---

## [1.1.0] - 2026-01-06

### 新增

- **阶段零：上下文收集（强制）**：写 PRD 前必须先了解项目上下文
  - 自动读取项目中的已有 PRD/HLD 文档
  - 识别项目命名规范和技术栈
  - 确保输出遵循项目现有约定
- **PRD 内容边界定义**：明确 PRD 与 HLD 的职责边界
  - PRD 只描述 What 和 Why，不规定 How
  - 添加正确/错误示例对比
- **边界检查（强制）**：在审查阶段增加边界检查步骤

### 变更

- **核心原则更新**
  - 新增「先读后写，遵循项目现有约定」原则
  - 新增「PRD 只描述 What 和 Why，不规定 How」原则
- **模板优化**（所有 5 个模板）
  - `new-feature-ui.md`：「数据模型」改为「数据概念」，移除技术字段定义
  - `new-feature-backend.md`：「接口规格」改为「接口能力」，移除 API 路径设计
  - `integration.md`：「集成方案」改为「集成需求」，移除技术接口映射
  - `refactoring.md`：移除架构图和代码结构变更，简化为业务层面描述
  - `optimization.md`：移除优化代码示例，简化为目标和验证要求
  - 所有模板添加「具体技术方案见 HLD」引用

### 修复

- 修复 PRD 内容越界到 HLD 领域的问题
- 修复不遵循项目现有约定的问题

---

## [1.0.0] - 2026-01-06

### 新增

- **prd-writer** 技能：PRD（产品需求文档）写作技能
  - 支持 5 种 PRD 类型：新功能（有UI）、新功能（无UI）、第三方集成、功能重构、性能/安全优化
  - 4 阶段工作流程：需求理解 → 结构规划 → 内容撰写 → 强制审查
  - 使用 AskUserQuestion 工具进行结构化交互
  - 包含 5 个专业模板
